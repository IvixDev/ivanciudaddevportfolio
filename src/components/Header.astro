---
import { Icon } from "astro-icon/components";
import { headerLinks, socialMediaLinks } from "../content/layout.consts";

const path = Astro.url.pathname;
const firstSlug = `/${path.split("/")[1]}`;
---

<header class="flex justify-center sticky top-0 z-50 w-full backdrop-blur-md bg-slate-950/80 border-b border-white/10 transition-all duration-300">
  <div
    class="flex flex-row justify-between max-w-screen-tablet p-4 tablet:px-8
    tablet:max-w-screen-laptop laptop:px-16 desktop:max-w-screen-desktop
    bigDesktop:max-w-screen-bigDesktop place-items-center w-full"
  >
    <a aria-label="Home" href="/" class="flex items-center gap-3 group">
      <div class="p-1.5 bg-white/5 rounded-full border border-white/10 group-hover:border-cyan-500/50 transition-colors">
        <Icon aria-label="Logo" class="size-8 text-cyan-400 group-hover:scale-110 transition-transform" name="logo" />
      </div>
      <span class="hidden tablet:block font-bold text-lg text-slate-200 group-hover:text-white transition-colors">Iván Ciudad Espinar</span>
    </a>
    <nav class="hidden tablet:flex flex-row gap-1 items-center bg-slate-900/50 p-1 rounded-full border border-white/10 backdrop-blur-md shadow-sm">
      {
        headerLinks &&
          headerLinks.map((link) => (
            <a
              class={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 ${firstSlug === link.href ? "bg-white/10 text-cyan-400 shadow-[inset_0_1px_0_0_rgba(255,255,255,0.1)]" : "text-slate-400 hover:text-slate-200 hover:bg-white/5"}`}
              href={link.href}
            >
              {link.label}
            </a>
          ))
      }
    </nav>
    <div class="hidden tablet:flex flex-row gap-3 items-center px-4">
      {
        socialMediaLinks &&
          socialMediaLinks.map((link) => (
            <a 
              href={link.href} 
              target="_blank" 
              aria-label={link.ariaLabel}
              class="text-slate-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
            >
              <Icon class="size-5" name={link.name} />
            </a>
          ))
      }
    </div>
    <button
    aria-expanded="false"
    id="burger-menu"
    class="burger-menu group relative flex h-[20px] flex-col items-center justify-between tablet:hidden w-6"
    aria-label="Abrir menú de navegación"
  >
    <span class="group-[.open]:translate-y-2 group-[.open]:rotate-45 h-[2px] w-6 bg-gray-300 transition ease transform duration-300"></span>
    <span class="group-[.open]:opacity-0 h-[2px] w-6 bg-gray-300 transition ease transform duration-300"></span>
    <span class="group-[.open]:opacity-0 h-[2px] w-6 bg-gray-300 transition ease transform duration-300"></span>
    <span class="group-[.open]:translate-y-[-0.6rem] group-[.open]:-rotate-45 h-[2px] w-6 bg-gray-300 transition ease transform duration-300"></span>
  </button>
  </div>
  <div id="mobile-menu" class="z-[-1] hidden-menu tablet:hidden shadow-2xl bg-slate-950/95 backdrop-blur-xl flex flex-col absolute top-full left-0 right-0 w-full border-b border-white/10" aria-label="Mobile menu">
    <nav class="flex flex-col p-4 gap-2">
    {
      headerLinks &&
      headerLinks.map((link) => (
        <a
          class={`w-full py-3 text-center rounded-lg transition-all duration-200 text-lg ${firstSlug === link.href ? "bg-white/10 text-cyan-400 font-medium" : "text-slate-400 hover:text-white hover:bg-white/5"}`}
          href={link.href}
        >
          {link.label}
        </a>
        ))
      }
    </nav>  
    <div class="flex flex-row gap-4 justify-center items-center py-6 border-t border-white/10 bg-white/5">
      {
        socialMediaLinks &&
          socialMediaLinks.map((link) => (
            <a href={link.href} target="_blank" aria-label={link.ariaLabel}>
              <Icon class="size-6 scale-on-hover-big" name={link.name} />
            </a>
          ))
      }
    </div>
  </div>
</header>
<script>
  const toggleBurger = () => {
    //Animate the burger menu
    const burgerMenuSticks = document.getElementsByClassName("burger-menu");
    const burgerMenuSticksArray = Array.from(burgerMenuSticks);

    burgerMenuSticksArray.forEach((element) => {
      element.classList.toggle("open");
    });
  }
  
  const toggleMenu = () => {
    //Collapse or expand the menu
    const menu = document.getElementById("mobile-menu");
    menu?.classList.toggle("hidden-menu");
    menu?.classList.toggle('visible-menu');

    toggleBurger();
  }

  const closeMenu = (event: MouseEvent) =>{
    const menu = document.getElementById("mobile-menu");
    const burgerMenu = document.getElementById("burger-menu");
    if (menu && burgerMenu && !menu.contains(event.target as Node) && !burgerMenu.contains(event.target as Node)) {
      menu.classList.add("hidden-menu");
      menu.classList.remove("visible-menu");
    }
    if(burgerMenu && !burgerMenu.contains(event.target as Node) && burgerMenu.classList.contains("open")){
      toggleBurger();
    }
  }

  const attachEventListeners =() => {
    const burgerMenu = document.getElementById("burger-menu");
    if (burgerMenu) {
      burgerMenu.addEventListener("click", toggleMenu);
    }
    document.addEventListener("click", closeMenu);
  }

  const detachEventListeners =() => {
    const burgerMenu = document.getElementById("burger-menu");
    if (burgerMenu) {
      burgerMenu.removeEventListener("click", toggleMenu);
    }
    document.removeEventListener("click", closeMenu);
  }

  document.addEventListener("astro:before-swap", detachEventListeners);
  document.addEventListener("astro:page-load", attachEventListeners);
</script>
<style>
  a:hover {
    color: #98e2ed;
  }
  .icon-scale:hover {
    transform: scale(1.1);
    transition: 0.3s ease-in-out;
  }
  .hidden-menu {
    border: 0;
    margin: 0;
    padding: 0;
    max-height: 0;
    overflow: hidden;
    pointer-events: none;
    transition: max-height 0.6s ease-in-out;
  }
  .visible-menu {
    max-height: 256px;
    overflow: hidden;
    pointer-events: auto;
    transition: max-height 0.6s ease-in-out;
  }
</style>
